@model FinanciamientosViewModels


<style>
    input[type="checkbox"] {
        opacity: 1;
    }
</style>

<link href="~/Content/css/financiamiento_mobile.css" rel="stylesheet" />

<section class="flat-row">
    <div class="container-full">
        <div class="row">
            <div class="col-md-12">
                <div style="text-align: center !important; background-color: #ec0002 !important ">
                    <div>
                        <div class="item-image">
                            <img src="~/Content/bm3/images/banner/santander-v2.jpg" alt="" class="img-fluid">
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section>

    <div class="container-full" style="background-color:whitesmoke;">
        <div class="container" id="mod_financiera">

            <div class="row" style="padding:10px;">
                <div class="form-group">
                    <h3>Para solicitar financiamiento, complete el siguiente formulario.</h3>
                </div>
            </div>

            <div class="formulario_financiera">
                <form method="post" id="frmSantander">
                    <div class="card-body">
                        <div class="row">

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="Nombre">Nombre<span class="text-danger">*</span></label>
                                    <input class="form-control" type="text" name="Nombre" placeholder="Ingrese Nombre" id="txtNombre" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Ingrese Nombre'" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="Apellido">Apellidos<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="txtApellido" name="Apellido" placeholder="Ingrese Apellido" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Ingrese Apellido'">
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="Celular">Celular<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="txtCelular" name="Celular" placeholder="Ingrese Celular" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Ingrese Celular'" maxlength="9">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="Correo">Email<span class="text-danger">*</span></label>
                                    <input class="form-control" id="txtCorreo" type="email" name="Correo" placeholder="Ingrese Correo" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Ingrese Correo'">
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="TipoDocumento">Tipo Documento<span class="text-danger">*</span></label>
                                    <select id="cboTipoDocumento" class="form-control custom-select" name="TipoDocumento">
                                        <option value="1">DNI</option>
                                        <option value="2">C.Extranjería</option>
                                        <option value="3">Pasaporte</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="NroDocumento">Nro Documento<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="txtNroDocumento" name="NroDocumento" placeholder="Ingrese NroDocumento" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Ingrese NroDocumento'" maxlength="20">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="InteresCompra">Interes Compra<span class="text-danger">*</span></label>
                                    <select id="cboInteresCompra" class="form-control custom-select" name="InteresCompra">
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="Departamento">Departamento<span class="text-danger">*</span></label>
                                    <select id="cboDepartamento" class="form-control" name="Departamento">
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="Provincia">Provincia<span class="text-danger">*</span></label>
                                    <select id="cboProvincia" class="form-control custom-select" name="Provincia">
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="Marca">Marca<span class="text-danger">*</span></label>
                                    <select id="cboMarca" class="form-control custom-select" name="Marca">
                                    </select>
                                </div>
                            </div>

                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="Modelo">Modelo<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="txtModelo" name="Modelo" placeholder="Ingrese Modelo" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Ingrese Modelo'">
                                </div>
                            </div>

                        </div>
                        <div class="row">

                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="RangoIngresos">Rango de Ingresos<span class="text-danger">*</span></label>
                                    <select id="cboRangoIngresos" class="form-control custom-select" name="RangoIngresos">
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="MontoFinanciar">Monto a Financiar<span class="text-danger">*</span></label>
                                    <select id="cboMontoFinanciar" class="form-control custom-select" name="MontoFinanciar">
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 form-check">
                                <input type="checkbox" name="TieneInicial" id="TieneInicial">
                                <label class="form-check-label" for="TieneInicial">
                                    ¿Cuentas con Inicial?
                                </label>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group" id="formMontoInicial">
                                    <label for="MontoInicial">Monto Inicial</label>
                                    <input type="number" required class="form-control" id="txtMontoInicial" name="txtMontoInicial" placeholder="Ingrese Monto Inicial" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Monto Inicial'" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 form-check">
                                <input type="checkbox" name="PoliticaPrivacidad" id="PoliticaPrivacidad">
                                <label class="form-check-label" for="PoliticaPrivacidad">
                                    He leido y acepto la politica de privacidad
                                </label>
                            </div>
                        </div>                        
                        <div class="row">
                            <div class="col-md-12 form-check">
                                <input type="checkbox" name="AceptoComunicaciones" id="AceptoComunicaciones">
                                <label class="form-check-label" for="AceptoComunicaciones">
                                    Acepto recibir comunicaciones comerciales de LA EMPRESA
                                </label>
                            </div>
                        </div>                        
                        <div class="row">
                            <div class="col-md-12 text-center">
                                <button class="btn btn-tprimary" type="submit" id="actionButton"><i class="fa fa-paper-plane" aria-hidden="true"></i> Solicitar Financiamiento</button>
                            </div>
                        </div>
                        <br />
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<script src="~/Content/lib/jquery-3.4.1/jquery.min.js"></script>
<script>
        $(document).ready(function () {
            listarMarcas();
            listaRangoIngreso();
            listaMontoFinanciar();
            listaInteresCompra();
            listaDepartamento();

            ValidaSoloTexto();
            ValidaSoloNumeros();

            $("#frmSantander").submit(function (event) {
                GuardarFinanciamientoSantander();
                event.preventDefault();
            })

            $("input[name='TieneInicial']").click(function () {

                if ($(this).is(':checked')) {
                    $("#formMontoInicial").show(300);
                } else {
                    $("#formMontoInicial").hide(300);
                }
            });

        });


        function ValidaSoloTexto() {
            $("#txtNombre").bind('keypress', function (event) {
                var regex = new RegExp("^[a-zA-Z ]+$");
                var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                if (!regex.test(key)) {
                    event.preventDefault();
                    return false;
                }
            });

            $("#txtApellido").bind('keypress', function (event) {
                var regex = new RegExp("^[a-zA-Z ]+$");
                var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                if (!regex.test(key)) {
                    event.preventDefault();
                    return false;
                }
            });
        }

        function ValidaSoloNumeros() {
            $("#txtCelular").bind('keypress', function (event) {
                var regex = new RegExp("^[0-9]+$");
                var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                if (!regex.test(key)) {
                    event.preventDefault();
                    return false;
                }
            });

            $("#txtNroDocumento").bind('keypress', function (event) {
                var regex = new RegExp("^[0-9]+$");
                var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
                if (!regex.test(key)) {
                    event.preventDefault();
                    return false;
                }
            });
        }



       function GuardarFinanciamientoSantander() {
                    var Nombre = $("#txtNombre").val();
                    var Apellido = $("#txtApellido").val();
                    var Celular = $("#txtCelular").val();
                    var Correo = $("#txtCorreo").val();
                    var TipoDocumento = $("#cboTipoDocumento").val();
                    var NroDocumento = $("#txtNroDocumento").val();
                    var InteresCompra = $("#cboInteresCompra").val();
                    var Departamento = $("#cboDepartamento").val();
                    var Provincia = $("#cboProvincia").val();
                    var Marca = $("#cboMarca").val();
                    var Modelo = $("#txtModelo").val();
                    var TipoVivienda = 0;
                    var SituacionLaboral = 0;
                    var SituacionSentimental = 0;
                    var RangoIngreso = $("#cboRangoIngresos").val();
                    var MontoFinanciar = $("#cboMontoFinanciar").val();
                    var PoliticaPrivacidad = document.getElementById('PoliticaPrivacidad').checked;
                    var AceptoComunicaciones = document.getElementById('PoliticaPrivacidad').checked;
                    var TipoFinanciera = 2;
                    var TieneInicial = document.getElementById('TieneInicial').checked;
                    var MontoInicial = $("#txtMontoInicial").val();

                if (Nombre == "" || Nombre.length == 0) {
                    alertify.warning('Ingrese un Nombre');
                    return false;
                } else if (Apellido == "" || Apellido.length == 0) {
                    alertify.warning('Ingrese un Apellido');
                    return false;
                } else if (Celular == "" || Celular.length == 0) {
                    alertify.warning('Ingrese un Celular');
                    return false;
                } else if (Correo == "" || Correo.length == 0) {
                    alertify.warning('Ingrese un Correo');
                    return false;
                } else if (NroDocumento == "" || NroDocumento.length == 0) {
                    alertify.warning('Ingrese un Documento');
                    return false;
                } else if (Modelo == "" || Modelo.length == 0) {
                    alertify.warning('Ingrese un Correo');
                    return false;
                } else if (InteresCompra == "" || InteresCompra.length == 0) {
                    alertify.warning('Ingrese un InteresCompra');
                    return false;                
                } else if (RangoIngreso == "" || RangoIngreso.length == 0) {
                    alertify.warning('Ingrese un RangoIngreso');
                    return false;
                } else if (MontoFinanciar == "" || MontoFinanciar.length == 0) {
                    alertify.warning('Ingrese un MontoFinanciar');
                    return false;
                }

                    var model = new Object();
                    model.Nombre = Nombre;
                    model.Apellido = Apellido;
                    model.Celular = Celular;
                    model.Correo = Correo;
                    model.TipoDocumento = TipoDocumento;
                    model.NroDocumento = NroDocumento;
                    model.InteresCompra = InteresCompra;
                    model.Departamento = Departamento;
                    model.Provincia = Provincia;
                    model.Distrito = 0;
                    model.Marca = Marca;
                    model.Modelo = Modelo;
                    model.TipoVivienda = TipoVivienda;
                    model.SituacionLaboral = SituacionLaboral;
                    model.SituacionSentimental = SituacionSentimental;
                    model.RangoIngreso = RangoIngreso;
                    model.PoliticaPrivacidad = PoliticaPrivacidad;
                    model.AceptoComunicaciones = AceptoComunicaciones;
                    model.MontoFinanciar = MontoFinanciar;
                    model.TipoFinanciera = TipoFinanciera;
                    model.TieneInicial = TieneInicial;
                    model.MontoInicial = MontoInicial;

                    $.ajax({
                        method: "POST",
                        url: "/Financiamiento/GuardarFinanciamiento",
                        data: {
                            model
                        },
                        success: function (result) {
                            Swal.fire("Gracias por tu Preferencia!", 'Enviado Correctamente', "success");
                             window.location.href = "@Url.Home()";
                        }

                    });

                }


    //function Limpiar() {

    //     $("#txtNombre").val('');
    //     $("#txtApellido").val();
    //     $("#txtCelular").val();
    //     $("#txtCorreo").val();
    //     $("#cboTipoDocumento").val();
    //     $("#txtNroDocumento").val();
    //     $("#cboInteresCompra").val();
    //     $("#cboDepartamento").val();
    //     $("#cboProvincia").val();
    //     $("#cboMarca").val();
    //     $("#txtModelo").val();
    //     $("#cboRangoIngresos").val();
    //     $("#cboMontoFinanciar").val();
    //     document.getElementById('PoliticaPrivacidad').checked;
    //     document.getElementById('PoliticaPrivacidad').checked;

    //}

        function listarMarcas() {
            $.ajax({
                method: "GET",
                url: "/Financiamiento/listarMarca",
                success: function (result) {
                    debugger;
                    console.log(result);
                    let Marca = result;
                    llenarCombo(Marca, "cboMarca", "Descripcion", "Descripcion", "0")
                }
            });
        }

        function listaRangoIngreso() {
            $.ajax({
                method: "GET",
                url: "/Financiamiento/listaRangoIngreso",
                success: function (result) {
                    debugger;
                    console.log(result);
                    let Marca = result;
                    llenarCombo(Marca, "cboRangoIngresos", "Valor", "Codigo", "0")
                }
            });
        }

        function listaInteresCompra() {
            $.ajax({
                method: "GET",
                url: "/Financiamiento/listaInteresCompra",
                success: function (result) {
                    debugger;
                    console.log(result);
                    let Marca = result;
                    llenarCombo(Marca, "cboInteresCompra", "Valor", "Codigo", "0")
                }
            });
        }

        function listaMontoFinanciar() {
                $.ajax({
                    method: "GET",
                    url: "/Financiamiento/listaMontoFinanciar",
                    success: function (result) {
                        debugger;
                        console.log(result);
                        let Marca = result;
                        llenarCombo(Marca, "cboMontoFinanciar", "Valor", "Codigo", "0")
                    }
                });
            }

        function listaDepartamento() {
            $.ajax({
                method: "GET",
                url: "/Financiamiento/listarDepartamentos",
                success: function (result) {
                    debugger;
                    console.log(result);
                    let Marca = result;
                    llenarComboDpto(Marca, "cboDepartamento", "NombreUbigeo", "CodDep", "0")
                }
            });
        }

        function llenarCombo(data, id, propiedadMostrar, propiedadId, valueDefecto = "") {
            debugger;
            var contenido = ""
            var elemento;
            contenido += "<option value='" + valueDefecto + "'>--Seleccionar--</option>"
            for (var j = 0; j < data.length; j++) {
                elemento = data[j];
                contenido +=
                    "<option value='" + elemento[propiedadId] + "' >" + elemento[propiedadMostrar] + "</option>"
            }
            contenido += "";
            document.getElementById(id).innerHTML = contenido;
    }

        function llenarComboDpto(data, id, propiedadMostrar, propiedadId, valueDefecto = "") {
            debugger;
            var contenido = ""
            var elemento;
            contenido += "<option value='" + valueDefecto + "'>--Seleccionar--</option>"
            for (var j = 0; j < data.length; j++) {
                elemento = data[j];
                contenido +=
                    "<option value='" + elemento[propiedadId] + "|" + elemento[propiedadMostrar] + "'  >" + elemento[propiedadMostrar] + "</option>"
            }
            contenido += "";
            document.getElementById(id).innerHTML = contenido;
    }


    $("#cboDepartamento").on('change', function () {
        debugger;
        var cboDpto = $("#cboDepartamento").val();
        var splitdepart = cboDpto.split('|');
        var departamento = splitdepart[0];
        $.ajax({
            method: "GET",
            url: "/Financiamiento/listarProvincias",
            data: { departamento },
            success: function (result) {
                debugger;
                console.log(result);
                let Marca = result;
                llenarCombo(Marca, "cboProvincia", "NombreUbigeo", "NombreUbigeo", "0")
            }
        });

    });

</script>





